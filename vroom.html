<script>
function loadModel() {
  const model = document.getElementById('modelInput').value.trim();
  if (!teslaData[model]) {
    alert('No data found for ' + model + '. Please try another model.');
    return;
  }
  const { coords, connections } = teslaData[model];
  const traces = [];

  // Add component points
  for (const [name, pos] of Object.entries(coords)) {
    traces.push({
      type: 'scatter3d',
      mode: 'markers+text',
      x: [pos[0]],
      y: [pos[1]],
      z: [pos[2]],
      text: [name],
      textposition: 'top center',
      marker: { size: 6, color: 'cyan' }
    });
  }

  // Add connections
  for (const [a, b] of connections) {
    traces.push({
      type: 'scatter3d',
      mode: 'lines',
      x: [coords[a][0], coords[b][0]],
      y: [coords[a][1], coords[b][1]],
      z: [coords[a][2], coords[b][2]],
      line: { width: 3, color: 'orange' }
    });
  }

  // Add car body mesh
  if (model !== 'Cybertruck') {
    // Smooth curved Tesla body
    const meshX = [-0.8, 0.8, 0.8, -0.8, -0.8, 0.8, 0.8, -0.8, 0, 0];
    const meshY = [-1.5, -1.5, 1.5, 1.5, -1.5, -1.5, 1.5, 1.5, 0, 0];
    const meshZ = [0, 0, 0, 0, 0.8, 0.8, 0.8, 0.8, 1.2, 1.2];

    // Curving the roof/front/back
    for (let i = 0; i < meshZ.length; i++) {
      if (i === 8 || i === 9) meshZ[i] = 1.2;       // top ridge
      if (i >= 0 && i <= 3) meshZ[i] = 0.1;         // bottom corners
      if (i >= 4 && i <= 7) meshZ[i] = 0.8;         // side/top
    }

    traces.push({
      type: 'mesh3d',
      x: meshX,
      y: meshY,
      z: meshZ,
      i: [0,0,0,4,4,1,2,3,0,4,5,6,7,1,2,3],
      j: [1,2,3,5,6,5,6,7,8,8,9,9,4,5,6,7],
      k: [2,3,0,6,7,6,7,4,9,9,8,8,6,7,4,5],
      color: 'lightgrey',
      opacity: 0.25,
      flatshading: true
    });
  } else {
    // Cybertruck - keep boxy mesh
    traces.push({
      type: 'mesh3d',
      x: [-1.0,1.0,1.0,-1.0,-1.0,1.0,1.0,-1.0],
      y: [-2.0,-2.0,2.0,2.0,-2.0,-2.0,2.0,2.0],
      z: [0,0,0,0,1.0,1.0,1.0,1.0],
      i: [0,0,0,4,4,1,2,3,5,6,1,2],
      j: [1,2,3,5,6,5,6,7,6,7,2,3],
      k: [2,3,0,6,7,6,7,4,7,4,3,0],
      color: 'grey',
      opacity: 0.2,
      flatshading: true
    });
  }

  const layout = {
    title: model + ' - 3D Component Map',
    scene: {
      xaxis: { title: 'Width (L-R)' },
      yaxis: { title: 'Length (F-B)' },
      zaxis: { title: 'Height' },
      aspectmode: 'manual',
      aspectratio: { x: 1.5, y: 3, z: 1 }
    },
    margin: { l: 0, r: 0, b: 0, t: 50 }
  };

  Plotly.newPlot('plot', traces, layout, { responsive: true });
}
</script>
